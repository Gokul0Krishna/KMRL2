<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KMRL Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/dashboard_style.css">
</head>
<body>
    <!-- Header Navigation -->
    <header>
        <nav>
            <div class="nav-left">
                <div class="logo">
                    <i class="fas fa-subway"></i>
                    <span>KMRL</span>
                </div>
                <ul class="nav-menu">
                    <li><a href="http://localhost:3000/dashboard" class="nav-link active" data-page="dashboard"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                    <li><a href="http://localhost:3000/service" class="nav-link" data-page="service"><i class="fas fa-cogs"></i> Service</a></li>
                    <li><a href="http://localhost:3000/maintenance" class="nav-link" data-page="maintenance"><i class="fas fa-tools"></i> Maintenance</a></li>
                    <li><a href="http://localhost:3000/alerts" class="nav-link" data-page="alerts"><i class="fas fa-bell"></i> Alerts</a></li>
                    <li><a href="http://localhost:3000/fitness" class="nav-link" data-page="fitness"><i class="fas fa-certificate"></i> Fitness</a></li>
                </ul>
            </div>
            
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
            
            <!-- User Profile Section -->
            <div class="nav-right">
                <div class="user-profile">
                    <div class="user-info">
                        <div class="user-name">Admin User</div>
                        <div class="user-role">System Administrator</div>
                    </div>
                    <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="user-photo">
                </div>
            </div>
        </nav>
    </header>

    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <ul class="sidebar-menu">
                <li><a href="http://localhost:3000/service" class="sidebar-link" data-page="service"><i class="fas fa-cogs"></i> Service</a></li>
                <li><a href="http://localhost:3000/standby" class="sidebar-link" data-page="standby"><i class="fas fa-pause-circle"></i> Standby</a></li>
                <li><a href="http://localhost:3000/maintenance" class="sidebar-link" data-page="maintenance"><i class="fas fa-tools"></i> Maintenance</a></li>
                <li><a href="http://localhost:3000/alerts" class="sidebar-link" data-page="alerts"><i class="fas fa-bell"></i> Alerts</a></li>
                <li><a href="http://localhost:3000/fitness" class="sidebar-link" data-page="fitness"><i class="fas fa-certificate"></i> Fitness Certificates</a></li>
                <li><a href="http://localhost:3000/schedule" class="sidebar-link" data-page="schedule"><i class="fas fa-calendar-alt"></i> Schedule</a></li>
                <li><a href="http://localhost:3000/staff" class="sidebar-link" data-page="staff"><i class="fas fa-users"></i> Staff</a></li>
                <li><a href="http://localhost:3000/trains" class="sidebar-link" data-page="trains"><i class="fas fa-train"></i> Trains</a></li>
                <li><a href="http://localhost:3000/reports" class="sidebar-link" data-page="reports"><i class="fas fa-chart-bar"></i> Reports</a></li>
                <li><a href="http://localhost:3000/settings" class="sidebar-link" data-page="settings"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Tonight's Summary Section -->
            <section class="summary-section">
                <h2><i class="fas fa-calendar-check"></i> Tonight's Summary</h2>
                
                <div class="summary-stats">
                    <% 
                        var validCount = 0;
                        var expiredCount = 0;
                        var today = new Date();
                        for (var i = 0; i < fitnessCertificates.length; i++) {
                            var fc = fitnessCertificates[i];
                            var parts = fc.expiry_date.split('-');
                            var expiry = new Date(parts[2], parts[1] - 1, parts[0]);
                            if (expiry > today) validCount++;
                            else expiredCount++;
                        }
                    %>
                    <div class="stat-item">
                        <h3>Total Trainsets</h3>
                        <p><%= fitnessCertificates.length %></p>
                    </div>
                    <div class="stat-item">
                        <h3>Valid Certificates</h3>
                        <p><%= validCount %></p>
                    </div>
                    <div class="stat-item">
                        <h3>Expired Certificates</h3>
                        <p><%= expiredCount %></p>
                    </div>
                </div>

                <div class="alert-item">
                    <span class="alert-icon">⚠️</span>
                    <span><%= expiredCount %> trains with expired certificates</span>
                </div>

                <button class="generate-schedule-btn">
                    <i class="fas fa-calendar-alt"></i> Generate Schedule
                </button>
            </section>

            <!-- Train Induction List Section -->
            <section class="train-list-section">
                <h2><i class="fas fa-list-alt"></i> Train Induction List</h2>

                <table class="train-table">
                    <thead>
                        <tr>
                            <th>Trainset ID</th>
                            <th>Status</th>
                            <th>Fitness Certificate</th>
                            <th>Job Cards</th>
                            <th>Branding</th>
                            <th>Priority</th>
                            <th>Mileage</th>
                            <!-- <th>Cleaning</th> -->
                            <% for (var i = 0; i < fitnessCertificates.length; i++) { %>
                            <tr>
                                <td><%= fitnessCertificates[i].train_id %></td>
                                <td><%
                                    var status;
                                    var statusClass;
                                    if (fitnessCertificates[i].signal === 'Pass' && fitnessCertificates[i].braking === 'Pass' && fitnessCertificates[i].structural_integrity === 'Pass') {
                                        status = 'Service';
                                        statusClass = 'status-service';
                                    } else if (fitnessCertificates[i].signal === 'Fail' || fitnessCertificates[i].braking === 'Fail' || fitnessCertificates[i].structural_integrity === 'Fail') {
                                        status = 'Maintenance';
                                        statusClass = 'status-maintenance';
                                    } else {
                                        status = 'Attention';
                                        statusClass = 'status-standby';
                                    }
                                    %><span class="<%= statusClass %>"><%= status %></span></td>
                                <td><%= fitnessCertificates[i].expiry_date %></td>
                                <td><%= fitnessCertificates[i].signal %> / <%= fitnessCertificates[i].braking %> / <%= fitnessCertificates[i].structural_integrity %></td>
                                <td>-</td>
                                <td>-</td>
                                <td>-</td>
                                <!-- <td>
                                    <button class="btn btn-primary">Details</button>
                                </td> -->
                            </tr>
                            <% } %>
                        <!-- <tr>
                            <td>Train-12</td>
                            <td><span class="status-standby">Standby</span></td>
                            <td>Expired</td>
                            <td>1 Pending</td>
                            <td>High</td>
                            <td>High</td>
                            <td>500 km</td>
                            <td>Completed</td>
                            <td><i class="fas fa-ellipsis-v"></i></td>
                        </tr>
                        <tr>
                            <td>Train-05</td>
                            <td><span class="status-standby">Standby</span></td>
                            <td>Expired</td>
                            <td>3 Open</td>
                            <td>Medium</td>
                            <td>Low</td>
                            <td>100 km</td>
                            <td>Due</td>
                            <td><i class="fas fa-ellipsis-v"></i></td>
                        </tr>
                        <tr>
                            <td>Train-14</td>
                            <td><span class="status-maintenance">Maintenance</span></td>
                            <td>Valid til 10/22</td>
                            <td>Completed</td>
                            <td>Low</td>
                            <td>High</td>
                            <td>550 km</td>
                            <td>Completed</td>
                            <td><i class="fas fa-ellipsis-v"></i></td>
                        </tr>
                        <tr>
                            <td>Train-18</td>
                            <td><span class="status-service">Service</span></td>
                            <td>Valid til 11/05</td>
                            <td>1 Pending</td>
                            <td>High</td>
                            <td>Medium</td>
                            <td>100 km</td>
                            <td>Due</td>
                            <td><i class="fas fa-ellipsis-v"></i></td>
                        </tr> -->
                    </tbody>
                </table>
            </section>

            <!-- What-If Simulator Section -->
            <section class="simulator-section">
                <h2><i class="fas fa-sliders-h"></i> What-If Simulator</h2>
                <div class="simulator-controls">
                    <input type="text" placeholder="Enter changes (e.g., 'Add 2 more trains to service')" class="simulator-input">
                    <button class="simulate-btn">
                        <i class="fas fa-play"></i> Simulate
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Basic functionality for the page
        document.addEventListener('DOMContentLoaded', function() {
            // Generate Schedule button functionality
            const generateBtn = document.querySelector('.generate-schedule-btn');
            generateBtn.addEventListener('click', function() {
                alert('Schedule generation started... This may take a few moments.');
                // Simulate loading
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
                this.disabled = true;
                
                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-check"></i> Schedule Generated!';
                    setTimeout(() => {
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }, 2000);
                }, 1500);
            });
            
            // Simulate button functionality
            const simulateBtn = document.querySelector('.simulate-btn');
            const simulatorInput = document.querySelector('.simulator-input');
            
            simulateBtn.addEventListener('click', function() {
                if (simulatorInput.value.trim() === '') {
                    alert('Please enter a scenario to simulate');
                    return;
                }
                
                alert(`Simulating scenario: "${simulatorInput.value}"\nResults would be shown here.`);
                simulatorInput.value = '';
            });
            
            // Table row click functionality
            const tableRows = document.querySelectorAll('.train-table tbody tr');
            tableRows.forEach(row => {
                row.addEventListener('click', function() {
                    const trainId = this.querySelector('td:first-child').textContent;
                    alert(`Showing details for ${trainId}`);
                    // In a real application, this would open a detailed view
                });
            });
            
            // Mobile menu toggle
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const navMenu = document.querySelector('.nav-menu');
            
            mobileMenuBtn.addEventListener('click', function() {
                navMenu.style.display = navMenu.style.display === 'flex' ? 'none' : 'flex';
            });
        });
    </script>
</body>
</html>